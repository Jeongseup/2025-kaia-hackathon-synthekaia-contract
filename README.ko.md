# SyntheKaia: 델타 중립 볼트 전략

SyntheKaia는 Kaia 네트워크에서 구축된 정교한 탈중앙화 금융(DeFi) 볼트로, 델타 중립 투자 전략을 구현합니다. USDT 예치를 받아 자동으로 듀얼 전략을 실행하여 수익을 창출하면서 전략적 헤징을 통해 시장 중립성을 유지합니다.

## 핵심 전략

사용자가 `StkaiaDeltaNeutralVault` 컨트랙트에 USDT를 예치하면, 자금이 단일 트랜잭션 내에서 두 가지 상호 보완적인 전략으로 자동 할당됩니다:

1.  **리퀴드 스테이킹 (50%)**: USDT의 절반이 Uniswap V3를 통해 **stKAIA** 토큰으로 스왑됩니다. 이를 통해 리퀴드 스테이킹 프로토콜을 통한 지속적이고 안정적인 스테이킹 보상을 생성하면서 KAIA의 스테이킹 수익에 대한 노출을 유지합니다.
2.  **무기한 숏 포지션 (50%)**: 나머지 절반은 K-bit PerpDEX에서 **KAIA**에 대한 레버리지 숏 포지션(2배)을 열기 위한 마진으로 사용됩니다. 이는 잠재적인 KAIA 가격 하락에 대한 헤지 역할을 하여 델타 중립 노출을 생성합니다.

## 델타 중립의 이점

이 전략은 다음을 목표로 합니다:
- **변동성 감소**: 숏 포지션이 KAIA 가격 움직임에 대해 헤지 역할
- **수익 창출**: stKAIA 포지션에서 스테이킹 보상 획득
- **시장 중립**: 상승 및 하락 가격 움직임 모두에서 수익 창출
- **자본 효율성**: 숏 포지션을 레버리지하여 헤징 효과 극대화

## 기술 스택

- **스마트 컨트랙트**: Solidity ^0.8.20
- **개발 프레임워크**: Foundry
- **표준**: ERC4626 볼트 표준
- **보안**: OpenZeppelin 업그레이드 가능한 컨트랙트
- **의존성**: Uniswap V3, K-bit PerpDEX, stKAIA 프로토콜

## 아키텍처

### ERC4626 볼트 구현
볼트는 ERC4626 표준을 구현하여 다음을 제공합니다:
- **표준화된 인터페이스**: 기존 DeFi 인프라와 호환
- **볼트 쉐어**: 사용자는 비례적 소유권을 나타내는 `sdnVS` 토큰을 받습니다
- **자동화된 전략**: 예치 시 전략 실행이 자동으로 트리거됩니다

### 업그레이드 가능한 컨트랙트 설계
OpenZeppelin의 업그레이드 가능한 컨트랙트로 구축:
- **미래 지향적**: 버그 수정 및 기능 향상을 위한 업그레이드 가능
- **보안**: 포괄적인 보안 조치 구현
- **접근 제어**: 소유자가 관리하는 관리 기능

## 프로젝트 구조

프로젝트는 모듈성, 보안 및 테스트 가능성에 중점을 두고 구성됩니다:

```
.
├── src/
│   ├── StkaiaDeltaNeutralVault.sol  # 핵심 볼트 컨트랙트 (ERC4626)
│   └── interfaces/                  # 외부 프로토콜 인터페이스
│       ├── IUniswapV3Router.sol    # Uniswap V3 스왑 인터페이스
│       ├── IPerpDex.sol            # K-bit PerpDEX 인터페이스
│       └── IUSDT.sol               # USDT 토큰 인터페이스
├── lib/                             # 의존성 (OpenZeppelin, Forge-std)
├── test/                            # 테스트 파일 (구현 예정)
├── script/                          # 배포 스크립트 (구현 예정)
├── Makefile                         # 빌드 및 배포 단축키
└── foundry.toml                     # Foundry 설정
```

## 시작하기

### 사전 요구사항

- [Foundry](https://book.getfoundry.sh/getting-started/installation)가 설치되어 있어야 합니다.

### 설치

1.  저장소를 클론합니다:

    ```bash
    git clone <your-repo-url>
    cd 2025-hackathon-kaia-syntekaia-contract
    ```

2.  의존성을 설치합니다:
    ```bash
    forge install
    ```

### 설정

컨트랙트를 배포하기 전에 환경을 설정해야 합니다. 프로젝트 루트에 아래 예시를 복사하여 `.env` 파일을 생성하세요.

```dotenv
# .env
# 대상 Kaia 네트워크의 RPC URL (예: Baobab 테스트넷 또는 Kaia 메인넷)
KAIA_RPC_URL="https://your-kaia-rpc-provider.com"

# 배포에 사용할 지갑의 개인 키
# 경고: 이 파일을 공개 저장소에 커밋하지 마세요.
PRIVATE_KEY="0xyour_wallet_private_key"

# 대상 네트워크의 프로토콜 주소
USDT_ADDRESS="0x..."                    # USDT 토큰 컨트랙트 주소
ST_KAIA_ADDRESS="0x..."                # stKAIA 리퀴드 스테이킹 토큰 주소
UNISWAP_V3_ROUTER_ADDRESS="0x..."     # Uniswap V3 라우터 주소
PERP_DEX_ADDRESS="0x..."              # K-bit PerpDEX 컨트랙트 주소
```

**중요**: 플레이스홀더 값을 대상 네트워크의 프로토콜 실제 주소와 개인 지갑 정보로 교체해야 합니다.

### 주요 설정 매개변수

볼트 컨트랙트는 다음 기본 매개변수를 사용합니다:
- **스왑 수수료**: 3000 (Uniswap V3 풀 수수료 0.3%)
- **레버리지**: 숏 포지션용 2배
- **토큰 타입**: PerpDEX 거래용 KAIA
- **오라클 타입**: BisonAI 및 Pyth 오라클 지원

## 사용법 (Makefile 명령어)

이 프로젝트는 가장 일반적인 작업에 대한 간단한 단축키를 제공하기 위해 `Makefile`을 사용합니다.

- **`make build`**
  프로젝트의 모든 스마트 컨트랙트를 컴파일합니다.

- **`make test`**
  Foundry 테스트 스위트를 실행합니다. 이는 로컬 환경에서 핵심 로직을 검증하기 위해 모의 컨트랙트를 사용합니다.

- **`make fmt`**
  `forge fmt`를 사용하여 Solidity 코드를 포맷합니다.

- **`make clean`**
  빌드 아티팩트(`out/`) 및 캐시 디렉토리를 제거합니다.

- **`make deploy`**
  `.env` 파일에 지정된 네트워크에 `StkaiaDeltaNeutralVault` 컨트랙트를 배포합니다. `KAIA_RPC_URL` 또는 `PRIVATE_KEY`가 설정되지 않으면 이 명령이 오류와 함께 실패합니다.

## 작동 원리

### 예치 프로세스
1. **사용자가 USDT 예치**: 사용자가 USDT 토큰과 함께 `deposit()` 함수를 호출합니다
2. **볼트 쉐어 발행**: 사용자는 볼트 쉐어를 나타내는 `sdnVS` 토큰을 받습니다
3. **전략 실행**: 볼트가 자동으로 델타 중립 전략을 실행합니다:
   - 50% USDT → Uniswap V3 스왑을 통한 stKAIA
   - 50% USDT → K-bit PerpDEX를 통한 KAIA 레버리지 숏 포지션

### 전략 이점
- **시장 중립**: 숏 포지션이 KAIA 가격 움직임에 대해 헤지 역할
- **수익 창출**: stKAIA 보유에서 스테이킹 보상 획득
- **자동화된 관리**: 수동 개입 불필요
- **ERC4626 호환**: 기존 DeFi 인프라와 작동

### 보안 기능
- **재진입 공격 방지**: 재진입 공격을 방지합니다
- **일시정지 기능**: 비상 정지 기능
- **소유자 제어**: 소유자에게 제한된 관리 기능
- **업그레이드 가능**: 프록시 패턴을 통한 향후 향상 가능

## 테스트

컨트랙트 로직이 건전한지 확인하기 위해 전체 테스트 스위트를 실행합니다:

```bash
make test
```

**참고**: 테스트 파일은 현재 개발 중입니다. 테스트 스위트에는 다음이 포함됩니다:
- 외부 프로토콜용 모의 컨트랙트
- 완전한 예치 플로우에 대한 통합 테스트
- 재진입 및 접근 제어에 대한 보안 테스트
- 최소 금액 및 프로토콜 실패에 대한 엣지 케이스 테스트

## 배포

### 사전 요구사항
1. 개인 키, RPC URL 및 대상 네트워크의 올바른 프로토콜 주소로 `.env` 파일이 올바르게 설정되어 있는지 확인합니다.
2. 대상 네트워크에서 모든 필수 외부 프로토콜이 배포되고 접근 가능한지 확인합니다.

### 배포 단계
1. 배포 명령을 실행합니다:

    ```bash
    make deploy
    ```

2. 성공하면 새로 배포된 `StkaiaDeltaNeutralVault` 컨트랙트의 주소가 콘솔에 출력됩니다.

3. **중요**: 이것은 업그레이드 가능한 컨트랙트이므로 구현 컨트랙트와 프록시 컨트랙트를 모두 배포해야 합니다. 프록시 주소는 볼트와 상호 작용하는 데 사용할 주소입니다.

4. 이제 컨트랙트 주소와 ABI(`out/StkaiaDeltaNeutralVault.sol/StkaiaDeltaNeutralVault.json`에서 찾을 수 있음)를 사용하여 프론트엔드 dApp에서 상호 작용할 수 있습니다.

### 배포 후
- **컨트랙트 초기화**: 필수 매개변수로 `initialize()` 함수를 호출합니다
- **배포 확인**: 컨트랙트가 올바르게 초기화되고 접근 가능한지 확인합니다
- **모니터링**: 전략 실행 및 볼트 상태에 대한 모니터링을 설정합니다

## 개발 상태

### ✅ 완료된 기능
- ERC4626 표준을 사용한 핵심 볼트 컨트랙트
- 델타 중립 전략 구현
- 포괄적인 보호 기능을 갖춘 보안 프레임워크
- 업그레이드 가능한 컨트랙트 아키텍처
- 외부 프로토콜용 인터페이스 정의

### ⚠️ 개발 중
- PerpDEX 포지션용 오라클 통합
- 스왑용 슬리피지 보호
- 완전한 총 자산 계산
- 인출 및 상환 로직
- 포괄적인 테스트 스위트

### 🔄 향후 향상
- 고급 포지션 관리
- 동적 레버리지 조정
- 다중 토큰 지원
- 수익 최적화 전략

## 위험 고려사항

**중요**: 이것은 실험적 소프트웨어입니다. 사용자는 다음 위험을 인식해야 합니다:

- **스마트 컨트랙트 위험**: 컨트랙트 코드의 버그로 인해 자금 손실이 발생할 수 있습니다
- **프로토콜 위험**: 외부 프로토콜(Uniswap V3, K-bit PerpDEX, stKAIA)에 대한 의존성
- **시장 위험**: 델타 중립 전략이 모든 시장 상황에서 예상대로 작동하지 않을 수 있습니다
- **유동성 위험**: 외부 프로토콜의 유동성 부족이 전략 실행에 영향을 줄 수 있습니다
- **오라클 위험**: 가격 피드 실패가 PerpDEX 포지션 관리에 영향을 줄 수 있습니다

## 라이선스

이 프로젝트는 MIT 라이선스 하에 라이선스가 부여됩니다.

## 참고 자료

- **stKAIA 프로토콜**: https://github.com/stakely-protocol/stakely-core
- **K-bit PerpDEX**: https://github.com/devKBit/k-bit
- **ERC4626 표준**: https://eips.ethereum.org/EIPS/eip-4626
- **OpenZeppelin 컨트랙트**: https://github.com/OpenZeppelin/openzeppelin-contracts